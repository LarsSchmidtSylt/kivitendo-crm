Kivitendo CRM 1.5.5  

Installtion Kivitendo CRM
-------------------------
Die Installation der CRM kann von jedem Administrator mit Linux-Grundkenntnissen 
durchgeführt werden und beansprucht einen Zeitaufwand von fünf bis zehn Minuten. 

Das Installationsscript erzeugt die notwendigen Verzeichnisse und Tabellen
für die CRM und erweitert einige Tabellen der ERP. Die Funktionstüchtigkeit 
der ERP wird dadurch nicht beeinträchtigt.

Die neuste Entwicklerversion kann mit "git clone git://vc.linet-services.de/public/lx-office-crm.git"
direkt aus dem Repository kopiert werden. Voraussetzung hierfür ist das Programmpaket Git 
(apt-get install git) 

Kivitendo hieß früher Lx-Office. Dadurch heißen einige Pfade noch lx-office.
Die Konfigurationsdatei der ERP wurde von lx_office.conf in kivitendo.conf umbenannt.
Aus Gründen der Kompatibilität zu älteren Installationen wird die lx_office.conf in der ERP weiterhin ausgewertet.
Welche ERP-Konfigurationsdatei in der CRM ausgewertet wird, kann in der CRM-Konfigurationsdatei inc/conf.php
der Variblen $erpConfigFile zugewiesen werden. Achtung, die Dateiendung (.conf) darf nicht mit angeben werden.
Voreingestellt ist kivitendo.conf.   

Vorrausetzungen:
	Kivitendo ERP >= 3.0.0
	PHP >= 4.2x
	 	PEAR::DB 
	oder
	 	PEAR::MDB2
	 	PEAR::MDB2#pgsql
	PEAR::Contact_Vcard_Build
	PEAR::Contact_Vcard_Parse
	PEAR::Mail_Mime oder php-mail-mime
		
	   jpgraph3
	oder
	   PEAR::Image_Canvas
	   PEAR::Image_Graph
	
	fpdf (http://www.fpdf.de/downloads/)
	fpdi (http://www.setasign.de/products/pdf-php-solutions/fpdi/downloads/)
	ttf-freefont
	php-gd,php-imap
	xajax (http://www.xajaxproject.org/)
    curl 
    jquery-ui (http://jqueryui.com/)
Fast alle Pakete können unter debianoiden Systemen in der Konsole mit folgendem Behfehl installiert werden.
apt-get install libapache2-mod-php5 php5-gd php5-imap php-mail php-mail-mime php-pear php-db php5-pgsql php-fpdf imagemagick php-xajax ttf-freefont php5-curl tinymce

jpgraph muß nicht mehr verwendet werden, wenn aber dann die Version 3. Alternativ wird PEAR::Image_Graph verwendet, kann aber mit PHP 5.3 Probleme machen.

Die restlichen Pearpaket installieren:
    pear install MDB2#pgsql DB MDB2 Image_Color Contact_Vcard_Build Contact_Vcard_Parse

Achtung! Das PEAR-Paket Image_Graph und Image_Canvas sind noch nicht "stable". Daher mit :
    pear install -f Image_Graph Image_Canvas
installieren.

Installierte Pearpakete anzeigen:
    pear list
  
FPDI installieren:
    mkdir /usr/share/php/fpdi && cd /usr/share/php/fpdi
    wget http://www.setasign.de/supra/kon2_dl/55450/FPDI-1.4.3.zip && unzip FPDI-1.4.3.zip
    ln -s /usr/share/php/fpdi/fpdi.php /usr/share/php/fpdi.php
    
jQuery-UI installieren:
    cd /usr/lib/lx-office-crm    
    wget https://github.com/downloads/jquery/jquery-ui/jquery-ui-1.9.2.zip && unzip jquery-ui-1.9.2.zip
    Links prüfen, ggf anlegen    
    ln -s jquery-ui-1.9.2 jquery-ui 
    cd jquery-ui-1.9.2 && ln -s jquery-1.8.3.js jquery.js


PHP5:
Den Fehlerreporting evtl. etwas runterschrauben. 
error_reporting  =  E_ALL & ~E_NOTICE 
PHP5.3:
error_reporting  =  E_ALL & ~E_NOTICE & ~E_DEPRECATED

PHP-Code wird angezeigt (sollte nicht mehr vorkommen):
short_open_tag = On

AJAX:
Die Installation wird i.d.R. mit apt-get durchgeführt, sämtliche Links bringt die CRM schon mit.
Nach und nach werden einige Masken mit Ajax bedient. 
"xajax" wird nicht mehr mitgeliefert!! xajax  sollte ganz normal im PfadZurCRM/crmajax erreichbar sein.
Zwei Versionen sind im Umlauf. Bei sehr alten Debian und Ubuntu wird als Paket V0.23 geliefert.
Aktuell ist die Version 0.5.
Egal wohin das Xajax-Paket installiert wird, sollten einige Links geprüft bzw erzeugt werden.
V0.23: (veraltet)
    kann nach /usr/share/php in das Verzeichnis xajax installiert werden.
    SymLink anlegen: ln -s /usr/share/php/xajax /PfadZurCRM/crmajax/
V0.5:
    Das Minimalpaket kann unter /PfadZurCRM/crmajax/ entpakt werden
    oder falls schon php-xajax installiert wurde
    zwei SymLinks prüfen ggf anlegen 
    ln -s /pfadzu/xajax/xajax_core /PfadZurCRM/crmajax/xajax_core
    ln -s /pfadzu/xajax/xajax_js /PfadZurCRM/crmajax/xajax_js 
Dann noch in der inc/conf.php die richtige Konstanten kontrollieren ggf aktivieren:
//Xajax => 0.5 evtl. auch 0.6
define("XajaxVer","05");
define("XajaxPath","./crmajax/");
//Xajax = 0.23
//define("XajaxVer","");
//define("XajaxPath","./crmajax/xajax");

Wird mit einem Alias für das LxO-Verzeichnis benutzt und soll in einigen Masken der 
jscalendar der ERP benutzt werden, muß das Verzeichnis ins CRM-Verzeichnis verlinkt werden:
cd lx-office-crm && ln -s ../lx-office-erp/js

evtl. php.ini anpassen: (i.d.R. nicht notwendig)
include_path = ".:/usr/share/php:/usr/share/fpdf:/usr/share/jpgraph"
extension=gd.so
.
.

Font für fpdf installieren (Debian):
cd /usr/share/php/Image/Canvas/Fonts
cp /usr/share/fonts/truetype/freefont/FreeSans.ttf .
echo FreeSans,FreeSans.ttf >> fontmap.txt 
 

Das TAR-File entpacken, dabei an HFS halten.
z.B. RPM-Systeme
	cd /srv/; tar xzf lx-office-crm-{version}.tgz
z.B. Debian
	cd /usr/lib/; tar xzf lx-office-crm-{version}.tgz

Crm in die ERP verlinken :
z.B. RPM-Systeme
	cd /srv/lx-office-erp && ln -s ../lx-office-crm crm
z.B. Debian
	cd /usr/lib/lx-office-erp && ln -s ../lx-office-crm crm

ERP-Menu erweitern:
	cd lx-office-erp
	mv menu.ini menu.ini.crm
	cat crm/update/menu.ini menu.ini.crm > menu.ini
Alternativ mit patch:
    patch -p1 -b ../lx-office-erp/menu.ini < update/menu.ini.patch 

Menuicon kopieren
	cd lx-office-erp && cp crm/image/CRM.png image/

Eigentümer der Datei auf Webserver setzen
z.B. Debian / Ubuntu:
	chown -R www-data: crm/
Andere:
	apache, apache2, httpd, www-run

Im Browser die ERP aufrufen und anmelden
	 -http://localhost/lx-office/login.pl

Melden Sie sich nun an Kivitendo-ERP an und wählen Sie einen CRM-Menüeintrag aus.
Die Datenbankinstallation wird nun durchgeführt.

Tiny-MCE:
Um den Editor in der Wissens-DB nutzen zu können muß in der conf.php die 
Variable tinymce mit True belegt werden.
Den Ordner /pfad/zu/tinymce/www nach /pfad/zu/lx-office-crm/inc/tiny_mce verlinken.
    ln -s /usr/share/tinymce/www/ /usr/lib/lx-office-crm/inc/tiny_mce

Geo-Datenbank:
--------------
In der Adressdatenmaske können einige Daten aus einer Geodatenbank gefüllt werden.
Dazu muß zuvor die Datenbank angelegt werden.

Dazu ein Terminalfenster öffnen oder per Fernzugriff auf dem Server auf der Konsole 
anmelden. In das Unterverzeichnis 'update' der CRM wechseln.

Die GeoDaten entpacken:

gunzip  geodaten.sql.gz

Die Postgresql-Konsole mit der entsprechenden Datenbankinstanz aufrufen:
	psql -U <dbuser> -W <meinedb>
In der PostgreSQL-Konsole folgendes eingeben:
	\i geostruck.sql
	\i geodaten.sql
Es rasseln eine Menge Meldungen durch, es sollten keine Fehler auftreten.
Die Konsole mit '\q' verlassen.

Jetzt noch die inc/conf.php öffnen und den Wert hinter 'GEODB' auf 'true' ändern.

Jetzt erscheint in den Eingabemasken ein Knopf 'suche Ort'. Geben Sie in Plz, Ort oder
Vorwahl einen (Teil-)Begriff ein und klicken Sie auf den Knopf. In einem Pop-Up werden
die Treffer angezeigt. Wird ein Wert ausgewählt, wird in Plz,Ort,Vorwahl der dazugehörige 
Wert eingetragen.

Die Ortsuche nutzt nur einen kleinen Teile der Geodaten die gespeichert sind (25-70MB). 
Klicken Sie in der Stammdatenmaske auf den Ortsnamen, öffnet siche ein neues Fenster.
Es werden zunächst alle Orte mit gleichem Namen und gleicher PLZ angezeigt. Klicken Sie
darauf, werden erweiterte Daten angezeigt. So können Sie durch Gemeinden, Kreise, 
Bundesländer usw. surfen.

Weitere Informationen zu den Daten sind hier zu finden:
http://opengeodb.giswiki.org/wiki/OpenGeoDB

BLZ-Datenbank:
--------------
In der Adressdatenmaske können einige Daten aus einer BLZ-Datenbank gefüllt werden.
Dazu muß zuvor die Datenbank angelegt werden.

Dazu ein Terminalfenster öffnen oder per Fernzugriff auf dem Server auf der Konsole 
anmelden. In das Unterverzeichnis 'update' der CRM wechseln. Die Postgresql-Konsole 
mit der entsprechenden Datenbankinstanz aufrufen:
	psql -U <dbuser> -W <meinedb>
In der PostgreSQL-Konsole folgendes eingeben:
	\i BLZ.sql
Es rasseln eine Menge Meldungen durch, es sollten keine Fehler auftreten.
Die Konsole mit '\q' verlassen.

Kopieren Sie die Datei update/blz.php nach <lx-office-erp>/lxo-import/ wenn diese noch
nicht vorhanden ist.
Erweitern Sie das LxO-Menü in der Sektion CSV-Import:

[System--Import CSV--BLZ]
module=lxo-import/blz.php

Die max_execution_time  sollte groß genu gewählt werden. Es sind über 20000 Datensätze.

Jetzt noch die inc/conf.php öffnen und den Wert hinter 'BLZDB' auf 'true' ändern.

Melden Sie sich neu an. Holen Sie von :
http://www.bundesbank.de/zahlungsverkehr/zahlungsverkehr_bankleitzahlen_download.php
die aktuellen Bankleitzahlen. Rufen Sie das Programm "System->CSV-Import->BLZ" auf
und importieren Sie damit die Daten.

Die Daten dürfen auf keinen Fall in UTF-8 gewandelt werden !!!

In der Bearbeitungsmaske der Firmen bekommen Sie nun unter "Sonstiges" einen neuen Knopf.

Zeiterfassung:
--------------
in der inc/conf.php müßen einige Vorbereitungen getätigt werden:
$ttpart='azstd'; //Artikelnummer für Arbeitszeit
$tttime=60;     //Anzahl der Minuten für eine Einheit
$ttround=15;    //Ab hier wird eine Einheit berechnet

Benutzerfreundliche Links:
--------------------------
ermöglichen einfacheres Speichern von Dateien vom Server bzw aus dem Netzwerk
und befinden sich in PfadZurCRM/Datenbankname/link_dir.
Die Links werden beim Speichern des Kunden nach dem Format "Kundenname_Kundennummer"
automatisch oder manuell unter CRM->Admin->Status erzeugt.
Link ins Home-Verzeichnis erstellen:
ln -s PfadZurCRM/Datenbankname/link_dir_cust /home/username/Kundendaten
Parameter in der conf.php
dir_mode=0775;  Owner + Gruppe Schreibrecht, andere Leserecht
dir_group=users; Mitglieder dieser Gruppe dürfen gesetzte Rechte       
sep_cust_vendor=true; Kunden und Lieferanten in unterschiedliche Verzeichnisse

Der Webserver sollte Mitglied in der Gruppe "dir_group" sein.
Das Verzeichnis "dokumente" sollte manuell auf Gruppe gesetzt werden.
Bei einer Migration auch alle Unterverzeichnisse und Dateien:
chmod 775 -R dokumente
chgrp -R users dokumente

Zusatzprogramme:
----------------
Einige Zusatzprogramme (EuR, ZM, Inventur, Katalog), die ich für mich geschrieben habe. Werden vielleicht ja mal
von jemanden in Perl umgesetzt, dann kommt das in die ERP.

Installation:
Menü um update/listen_menu.ini erweitern. Evtl. Bilderverzeichnis verlinken
Einige Zusatzprogrammei (EuR, ZM, Inventur, Katalog), die ich für mich geschrieben habe. Werden vielleicht ja mal
von jemanden in Perl umgesetzt, dann kommt das in die ERP.


Zusatzprogramme 2:
------------------
Barcodes für Artikel drucken:
Den Patch ic_form_header.patch in das File templates/webpages/ic/form_header.html einspielen.
Das Tex-File vorlage/barcode.tex anpassen.

Etiketten aus Rechnungsmaske drucken und E-Mais verschicken:
Den Patch is_form_footer.patch in templates/webpages/ir/form_footer.html und
Patch is_form_footer.patch in templates/webpages/is/form_footer.html einspielen.

Weitere Informationen, professioneller Support:
http://www.lx-system.de

